<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Data Analysis Studio</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header>
      <h1>Data Analysis Studio</h1>
      <div id="app-info"></div>
      <nav>
        <a href="/docs" target="_blank">OpenAPI Docs</a>
        <a href="/redoc" target="_blank">ReDoc</a>
      </nav>
    </header>

    <main>
      <datalist id="dataset-ids"></datalist>
      <datalist id="columns-suggest"></datalist>
      <datalist id="model-ids"></datalist>

      <section class="card">
        <h2>1) CSV 업로드</h2>
        <form id="upload-form">
          <label>Dataset ID(선택): <input type="text" id="dataset-id" placeholder="자동 생성" /></label>
          <label>CSV 파일: <input type="file" id="csv-file" accept=".csv,text/csv" required /></label>
          <button type="submit">업로드</button>
        </form>
        <div id="upload-result" class="muted"></div>
      </section>

      <section class="card">
        <h2>2) 데이터셋 목록</h2>
        <div class="toolbar">
          <button id="refresh-list">새로고침</button>
        </div>
        <div id="datasets-list"></div>
      </section>

      <section class="card">
        <h2>3) 미리보기</h2>
        <form id="preview-form">
          <label>Dataset ID: <input type="text" id="preview-id" list="dataset-ids" required /></label>
          <label>행 수: <input type="number" id="preview-n" value="20" min="1" max="1000" /></label>
          <button type="submit">미리보기</button>
        </form>
        <div id="preview-table"></div>
      </section>

      <section class="card">
        <h2>4) 요약 통계</h2>
        <form id="describe-form">
          <label>Dataset ID: <input type="text" id="describe-id" list="dataset-ids" required /></label>
          <label>샘플 제한: <input type="number" id="describe-limit" value="5000" min="10" max="200000" /></label>
          <label>전체 컬럼 포함: <input type="checkbox" id="describe-all" checked /></label>
          <button type="submit">요약 보기</button>
        </form>
        <div id="describe-table"></div>
      </section>

      <section class="card">
        <h2>5) 결측치 현황</h2>
        <form id="nulls-form">
          <label>Dataset ID: <input type="text" id="nulls-id" list="dataset-ids" required /></label>
          <label>제한(옵션): <input type="number" id="nulls-limit" placeholder="전체" min="1" /></label>
          <button type="submit">결측치 보기</button>
        </form>
        <div id="nulls-table"></div>
      </section>

      <section class="card">
        <h2>6) 타입 변환</h2>
        <form id="cast-form">
          <label>Source ID: <input type="text" id="cast-source" list="dataset-ids" required /></label>
          <label>Column: <input type="text" id="cast-column" list="columns-suggest" required /></label>
          <label>Target Type:
            <select id="cast-type">
              <option value="int">int</option>
              <option value="float">float</option>
              <option value="string">string</option>
              <option value="datetime">datetime</option>
              <option value="bool">bool</option>
              <option value="category">category</option>
            </select>
          </label>
          <label>Out ID(선택): <input type="text" id="cast-out" placeholder="자동 생성" /></label>
          <label><input type="checkbox" id="cast-strict" /> strict 모드(변환 실패 시 오류)</label>
          <button type="submit">변환 실행</button>
        </form>
        <div id="cast-result" class="muted"></div>
      </section>

      <section class="card">
        <h2>7) 분포(Distribution)</h2>
        <form id="dist-form">
          <label>Dataset ID: <input type="text" id="dist-id" list="dataset-ids" required /></label>
          <label>Column: <input type="text" id="dist-col" list="columns-suggest" required /></label>
          <label>Bins(숫자): <input type="number" id="dist-bins" value="20" min="1" max="200" /></label>
          <label>TopK(문자): <input type="number" id="dist-topk" value="20" min="1" max="200" /></label>
          <label><input type="checkbox" id="dist-dropna" checked /> 결측치 제외</label>
          <label><input type="checkbox" id="dist-chunked" /> chunked</label>
          <label>Chunk Size: <input type="number" id="dist-chunksize" value="50000" min="1000" step="1000" /></label>
          <button type="submit">분포 계산</button>
        </form>
        <div id="dist-chart" class="chart"></div>
        <div id="dist-view"></div>
      </section>

      <section class="card">
        <h2>8) 상관관계(Correlation)</h2>
        <form id="corr-form">
          <label>Dataset ID: <input type="text" id="corr-id" list="dataset-ids" required /></label>
          <label>Method:
            <select id="corr-method">
              <option value="pearson" selected>pearson</option>
              <option value="spearman">spearman</option>
              <option value="kendall">kendall</option>
            </select>
          </label>
          <label>제한: <input type="number" id="corr-limit" value="50000" min="100" /></label>
          <label><input type="checkbox" id="corr-chunked" /> chunked(pearson)</label>
          <label>Chunk Size: <input type="number" id="corr-chunksize" value="50000" min="1000" step="1000" /></label>
          <button type="submit">상관분석</button>
        </form>
        <div id="corr-chart" class="chart"></div>
        <div id="corr-view"></div>
      </section>

      <section class="card">
        <h2>9) 샘플/필터 다운로드</h2>
        <form id="sample-form">
          <label>Dataset ID: <input type="text" id="sample-id" list="dataset-ids" required /></label>
          <label>Rows: <input type="number" id="sample-rows" value="100" min="1" max="100000" /></label>
          <button type="submit">샘플 CSV 다운로드</button>
        </form>
        <hr />
        <form id="filter-form">
          <label>Dataset ID: <input type="text" id="filter-id" list="dataset-ids" required /></label>
          <label>Columns(쉼표): <input type="text" id="filter-cols" placeholder="예: col1,col2" /></label>
          <label>Limit: <input type="number" id="filter-limit" value="10000" min="0" max="500000" /></label>
          <label>Query: <input type="text" id="filter-query" placeholder="예: price > 10 and category == 'A'" /></label>
          <button type="submit">필터 CSV 다운로드</button>
        </form>
        <div class="muted">주의: Query는 pandas DataFrame.query 문법 사용</div>
      </section>

      <section class="card">
        <h2>10) 기초 전처리</h2>
        <h3>결측치 채우기(fillna)</h3>
        <form id="fillna-form">
          <label>Source ID: <input type="text" id="fillna-source" list="dataset-ids" required /></label>
          <label>Columns(선택, 쉼표): <input type="text" id="fillna-cols" placeholder="미입력 시 전체" /></label>
          <label>Strategy:
            <select id="fillna-strategy">
              <option value="value" selected>value</option>
              <option value="mean">mean</option>
              <option value="median">median</option>
              <option value="mode">mode</option>
            </select>
          </label>
          <label>Value(Strategy=value일 때): <input type="text" id="fillna-value" placeholder="예: 0 또는 'N/A'" /></label>
          <label>Out ID(선택): <input type="text" id="fillna-out" placeholder="자동 생성" /></label>
          <button type="submit">실행</button>
        </form>
        <div id="fillna-result" class="muted"></div>

        <h3>컬럼 삭제 (drop)</h3>
        <form id="drop-form">
          <label>Source ID: <input type="text" id="drop-source" list="dataset-ids" required /></label>
          <label>Columns(쉼표): <input type="text" id="drop-cols" required placeholder="예: col1,col2" /></label>
          <label>Out ID(선택): <input type="text" id="drop-out" placeholder="자동 생성" /></label>
          <button type="submit">실행</button>
        </form>
        <div id="drop-result" class="muted"></div>

        <h3>컬럼 이름 변경(rename)</h3>
        <form id="rename-form">
          <label>Source ID: <input type="text" id="rename-source" list="dataset-ids" required /></label>
          <label>Mapping(쉼표, 콜론): <input type="text" id="rename-mapping" placeholder="old1:new1,old2:new2" required /></label>
          <label>Out ID(선택): <input type="text" id="rename-out" placeholder="자동 생성" /></label>
          <button type="submit">실행</button>
        </form>
        <div id="rename-result" class="muted"></div>
      </section>

      <section class="card">
        <h2>11) 계산열(Compute)</h2>
        <form id="compute-form">
          <label>Source ID: <input type="text" id="compute-source" list="dataset-ids" required /></label>
          <label>Expression: <input type="text" id="compute-expr" placeholder="예: feature_1 + feature_2" required /></label>
          <label>Out Column: <input type="text" id="compute-outcol" placeholder="예: sum_f1_f2" /></label>
          <label><input type="checkbox" id="compute-inplace" /> 기존 컬럼 덮어쓰기</label>
          <label>Out ID(선택): <input type="text" id="compute-out" placeholder="자동 생성" /></label>
          <button type="submit">계산 실행</button>
        </form>
        <div id="compute-result" class="muted"></div>
      </section>

      <section class="card">
        <h2>12) 그룹집계(GroupBy)</h2>
        <form id="gb-form">
          <label>Source ID: <input type="text" id="gb-source" list="dataset-ids" required /></label>
          <label>By(,로 구분): <input type="text" id="gb-by" placeholder="예: category" required /></label>
          <label>Aggs(세미콜론/콤마): <input type="text" id="gb-aggs" placeholder="예: target:mean,sum; feature_1:mean" required /></label>
          <label><input type="checkbox" id="gb-dropna" checked /> NA 그룹 제외</label>
          <label><input type="checkbox" id="gb-asindex" /> as_index</label>
          <label><input type="checkbox" id="gb-chunked" /> chunked</label>
          <label>Chunk Size: <input type="number" id="gb-chunksize" value="50000" min="1000" step="1000" /></label>
          <label>Out ID(선택): <input type="text" id="gb-out" placeholder="자동 생성" /></label>
          <button type="submit">집계 실행</button>
        </form>
        <div id="gb-result" class="muted"></div>
      </section>

      <section class="card">
        <h2>13) 조인(Merge)</h2>
        <form id="merge-form">
          <label>Left ID: <input type="text" id="merge-left" list="dataset-ids" required /></label>
          <label>Right ID: <input type="text" id="merge-right" list="dataset-ids" required /></label>
          <label>On(,로 구분): <input type="text" id="merge-on" placeholder="예: key" required /></label>
          <label>How:
            <select id="merge-how">
              <option value="inner" selected>inner</option>
              <option value="left">left</option>
              <option value="right">right</option>
              <option value="outer">outer</option>
            </select>
          </label>
          <label>Suffixes: <input type="text" id="merge-suffixes" placeholder="예: _x,_y" /></label>
          <label>Out ID(선택): <input type="text" id="merge-out" placeholder="자동 생성" /></label>
          <button type="submit">조인 실행</button>
        </form>
        <div id="merge-result" class="muted"></div>
      </section>

      <section class="card">
        <h2>14) 정렬/상위(Sort/Limit)</h2>
        <form id="sort-form">
          <label>Source ID: <input type="text" id="sort-source" list="dataset-ids" required /></label>
          <label>By(,-접두어는 내림차순): <input type="text" id="sort-by" placeholder="예: -target,feature_1" required /></label>
          <label>Limit: <input type="number" id="sort-limit" value="100" min="0" /></label>
          <label><input type="checkbox" id="sort-chunked" /> chunked</label>
          <label>Chunk Size: <input type="number" id="sort-chunksize" value="50000" min="1000" step="1000" /></label>
          <label>Merge Batch: <input type="number" id="sort-batch" value="4" min="2" max="16" /></label>
          <label>Out ID(선택): <input type="text" id="sort-out" placeholder="자동 생성" /></label>
          <button type="submit">정렬 실행</button>
        </form>
        <div id="sort-result" class="muted"></div>
      </section>

      <section class="card">
        <h2>15) 중복 제거(Dedup)</h2>
        <form id="dedup-form">
          <label>Source ID: <input type="text" id="dedup-source" list="dataset-ids" required /></label>
          <label>Subset(,로 구분/미입력=전체): <input type="text" id="dedup-subset" placeholder="예: key" /></label>
          <label>Keep:
            <select id="dedup-keep">
              <option value="first" selected>first</option>
              <option value="last">last</option>
              <option value="none">none</option>
            </select>
          </label>
          <label><input type="checkbox" id="dedup-chunked" /> chunked</label>
          <label>Chunk Size: <input type="number" id="dedup-chunksize" value="50000" min="1000" step="1000" /></label>
          <label>Out ID(선택): <input type="text" id="dedup-out" placeholder="자동 생성" /></label>
          <button type="submit">중복 제거</button>
        </form>
        <div id="dedup-result" class="muted"></div>
      </section>

      <section class="card">
        <h2>16) 프로파일(Profile)</h2>
        <form id="prof-form">
          <label>Dataset ID: <input type="text" id="prof-source" list="dataset-ids" required /></label>
          <label>Sample Rows: <input type="number" id="prof-sample" value="10000" min="10" max="200000" /></label>
          <button type="submit">프로파일 조회</button>
        </form>
        <div id="prof-view"></div>
      </section>

      <section class="card">
        <h2>17) 모델 학습(Train)</h2>
        <form id="ml-train-form">
          <label>Dataset ID: <input type="text" id="ml-train-dataset" list="dataset-ids" required /></label>
          <label>Target: <input type="text" id="ml-train-target" list="columns-suggest" required /></label>
          <label>Model:
            <select id="ml-train-model">
              <option value="linreg">linreg (회귀)</option>
              <option value="logreg">logreg (이진/다중 분류)</option>
              <option value="rf_reg">rf_reg (랜덤포레스트 회귀)</option>
              <option value="rf_clf">rf_clf (랜덤포레스트 분류)</option>
            </select>
          </label>
          <label>Features(,로 구분/미입력=전체): <input type="text" id="ml-train-features" placeholder="예: f1,f2,f3" /></label>
          <label>Test Size: <input type="number" id="ml-train-testsize" value="0.2" min="0.05" max="0.9" step="0.05" /></label>
          <label>Sample Rows(선택): <input type="number" id="ml-train-samplerows" placeholder="예: 10000" min="10" /></label>
          <label>Sample Frac(선택): <input type="number" id="ml-train-samplefrac" placeholder="0~1" min="0" max="1" step="0.05" /></label>
          <label>Out Model ID(선택): <input type="text" id="ml-train-outid" placeholder="자동 생성" /></label>
          <button type="submit">학습 실행</button>
        </form>
        <div id="ml-train-result" class="muted"></div>
      </section>

      <section class="card">
        <h2>18) 예측(Predict)</h2>
        <form id="ml-predict-form">
          <label>Model ID: <input type="text" id="ml-predict-model" list="model-ids" required /></label>
          <label>Dataset ID: <input type="text" id="ml-predict-dataset" list="dataset-ids" required /></label>
          <label><input type="checkbox" id="ml-predict-proba" /> 확률 포함(분류)</label>
          <label>Out Dataset ID(선택): <input type="text" id="ml-predict-out" placeholder="자동 생성" /></label>
          <button type="submit">예측 실행</button>
        </form>
        <div id="ml-predict-result" class="muted"></div>
      </section>

      <section class="card">
        <h2>19) 모델 목록</h2>
        <div class="toolbar">
          <button id="ml-refresh-models">새로고침</button>
        </div>
        <div id="ml-models-list"></div>
      </section>
    </main>

    <footer>
      <span class="muted">UI는 단순 데모용입니다. 대용량 처리/보안은 서버 측에서 관리됩니다.</span>
    </footer>

    <script src="./app.js"></script>
    <script src="./suggest.js"></script>
  </body>
  </html>

